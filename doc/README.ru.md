# ReeePlayer

Приложение ReeePlayer предназначено для интервального повторения фрагментов (клипов) видео- и аудиофайлов по схожему принципу, что и в Anki-карточках, со следующими возможностями:

- Скачивание медиафайлов с различных ресурсов
- Просмотр видео- и аудиофайлов с двумя субтитрами (пока только внешними)
- Изменение скорости воспроизведения без изменения темпа
- Пропуск беззвучных и тихих фрагментов в реальном времени
- Быстрый выбор и сохранение видеоклипов вместе с текстом

## Ссылки в соцсетях

- [Facebook](https://www.facebook.com/groups/reeeplayer)
- [VK](https://vk.com/reeeplayer)

## Скачать

- [Для Windows (x64)](https://github.com/FilippVolodin/ReeePlayer/releases/download/v0.2/ReeePlayer-0.2-win-x64.zip)
- [Для Windows (старая версия, x86)](https://github.com/FilippVolodin/ReeePlayer/releases/download/v0.1/ReeePlayer-0.1-win-x86.zip)

## Основы

В самом начале для удобства рекомендуется создать или выбрать каталог на диске, в котором будут располагаться те медиафайлы, которые планируется использовать для интервального повторения. 

Этот каталог нужно открыть с помощью кнопки `Open Directory` или перетащить мышкой из проводника в окно приложения.

Открытый каталог будет выглядеть примерно так, как на рисунке (в начале количество клипов будет равно нулю).

![](./main_window.png?raw=true)

Для просмотра нужно дважды кликнуть по желаемому файлу.

![](./watching.png?raw=true)

Когда будет просмотрен некоторый фрагмент, который хотелось бы повторить в дальнейшем, нужно нажать кнопку `Add Clip` или клавишу `Enter`.

![](./adding_clip.png?raw=true)

При необходимости создаваемый клип может быть отредактирован. Для сохранения клипа и продолжения просмотра нужно нажать `Save Clip` или `Enter`. Подробное описание способов редактирования будет приведено далее.

Для повторения добавленных клипов необходимо нажать `Repeat Clips` в главном меню, либо выбрать необходимые файлы и подкаталоги, а затем выбрать `Repeat Selected` в контекстном меню.

В верхнем левом углу открывшегося окна показано оставшееся количество клипов, которые нужно повторить.

![](./repeating.png?raw=true)

Когда счетчик достигнет нуля, можно все равно продолжать повторение. В этом случае будут предлагаться наиболее подходящие клипы, у которых приближается время повторения. Для них интервал следующего повторения увеличится в зависимости от времени, прошедшего с предыдущего повторения.

## Подробности

### Подготовка медиа-файлов

В самом начале рекомендуется создать директорию для медиа-файлов, которые вы планируете  использовать для интервального повторения. Например, вы можете создать директорию `Video` на диске `C:` как показано ниже.

![](create_video_folder.png?raw=true)

Затем, для удобства, вы можете создать поддиректории в главной директории для видео с разной тематикой. Но это можно сделать и позже в любое время. Если у вас уже есть файлы, скопируйте их в созданную вами директорию (или поддиректорию).

![](copy_files.png?raw=true)

Запустите ReeePlayer и нажмите ![](open_directory.png?raw=true). Выберите главную директорию (например `C:\Video`) и нажмите `Select Folder`.

![](directory_example.png?raw=true)

ReeePlayer использует [yt-dlp](https://github.com/yt-dlp/yt-dlp), поэтому возможно скачать видео с [различных сайтов](https://github.com/yt-dlp/yt-dlp/blob/master/supportedsites.md). Нажмите кнопку `Download` ![](btn_download.png?raw=true).

Скопируйте одну ил несколько ссылок на видео в поле `URLs`.

![](download_window.png?raw=true)

Введите список языков субтитров через запятую. Можно использовать [регулярные выражения](https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F). Несколько примеров:

- `en` (английский без указания конкретной страны)
- `en-us` (американский английский)
- `en-gb` (британский английский)
- `en.*` (все доступные варианты английского)
- `en.*,ru.*,es.*` (все доступные варианты английского, русского и испанского)
- `.*` (все доступные субтитры)

Поле `Preferred resolution` (предпочитаемое разрешение) необходимо для ограничения размера скачиваемого видео. Распространенные разрешения: 360p, 480p, 720p, 1080p (чем выше значение - тем лучше качество и больше размер видео).

Укажите директорию и нажмите `Download`.

Чтобы сэкономить время на указании директории, можно щелкнуть правой кнопкой мыши на соответствующем каталоге в главном окне программы.

![](download_to.png?raw=true)

### Просмотр

При запуске просмотра видеофайла с именем вида `x.<ext>` приложение осуществляет поиск файлов субтитров с именем вида `x<lang>.<srt или vtt>` в том же каталоге. Доступные субтитры можно выбрать из выпадающего списка ![](./subs_cmb.png?raw=true) в обоих панелях. 

Поле ввода ![](./sync_subs.png?raw=true) предназначено для синхронизации субтитров с видео с помощью стрелок или колесика мыши.

Кнопка ![](./show_always.png?raw=true) управляет видимостью субтитров (всегда показывать или скрывать), а ![](./show_once.png?raw=true) – видимостью только текущего текста.

В режиме  просмотра доступны горячие клавиши:

- `Space` – воспроизведение/пауза
- `Left`, `Right` – перемотка назад или вперед на 2 секунды
- `3`, `4`, `5`, `6`, `7`, `8` – скорость воспроизведения: 0.5, 0.75, 1, 1.25, 1.5, 2 от нормальной
- `1`, `2` – показать текущий текст первых/вторых субтитров, если он скрыт
- `Enter` – добавить клип

Пропускать фрагменты с тишиной можно нажав кнопку ![](btn_jumpcutter.png?raw=true) на панели задач. Рекомендуется настроить обнаружение тихих фрагментов нажатием на ![](jumpcutter_settings.png?raw=true).

 ![](jumpcutter_window.png?raw=true)

Существует возможность ускоренной перемотки тихих фрагментов с помощью поля `Skip silence`. Но, к сожалению, плееру требуется время (700-1000 мс), чтобы изменить скорость после перемотки. Чтобы устранить негативный эффект, увеличьте значение в поле `Margin before` до хотя бы 700.

### Добавление клипа

 Начало и конец создаваемого клипа определяются по текущим субтитрам.

 ![](./clip_ab.png?raw=true)

 При необходимости можно изменить их с помощью:

- Клавишами `Ctrl+Left`, `Ctrl+Right`, `Alt+Left`, `Alt+Right` (рекомендуется). 
- Стрелок на панели инструментов
- Прокрутки колесика мыши при наведении на соответствующее поле ввода
- Мыши и графика звука, как показано ниже

 ![](waveform_clip_edit.png?raw=true)

Если необходимо дополнить текст клипа предыдущим или следующим текстом из субтитров, то это можно осуществить кнопками ![](./insert_cue.png?raw=true).

В режиме  просмотра доступны следующие клавиши:

- `Space` – воспроизвести клип
- `5`, `6`, `7`, `8`, `9`, `0` – скорость воспроизведения: 0.5, 0.6, 0.7, 0.8, 0.9, 1.0 от нормальной
- `Enter`, `Ctrl+Enter` – сохранить клип
- `Delete` – отменить создание клипа

### Повторение

В этом режиме доступно редактирование клипа (начало, конец, тексты) таким же способом, что и при создании.

Горячие клавиши:

- `Space` – воспроизвести клип
- `5`, `6`, `7`, `8`, `9`, `0` – скорость воспроизведения: 0.5, 0.6, 0.7, 0.8, 0.9, 1.0 от нормальной
- `Enter` – отметить клип повторенным и перейти к следующему
- `Backspace` – вернуться к предыдущим повторенным клипам

### Где хранятся клипы

Все клипы файла с именем вида `x.<ext>` хранятся в файле `x.user.json` в той же директории. Например:

![](./files_example.png?raw=true)

Такой подход хранения позволяет изменять файловую иерархию по своему усмотрению, а именно перемещать, переименовывать, объединять каталоги. Самое главное – хранить файл с клипами рядом с медиафайлом и перемещать их только вместе.

В качестве формата файла используется [JSON](https://ru.wikipedia.org/wiki/JSON), что позволяет просматривать и редактировать его в любом текстовом редакторе:

![](./json_example.png?raw=true)

## Сборка

Для сборки необходимо использовать компилятор с поддержкой C++17. На данный момент тестирование производилось только для MSVC 2019.

### Windows

- Установить [Qt 6](https://www.qt.io/). Добавить в переменную среды `PATH` каталог `%QTDIR%/bin`
- Скачать медиаплейер [VLC 3.0.8](http://download.videolan.org/pub/videolan/vlc/3.0.8/). Добавить в переменную среды `PATH` каталог с распакованным архивом, либо скопировать директорию `plugins` и библиотеки `libvlc.dll`, `libvlccore.dll` в каталог сборки.
- Установить cmake версии не ниже 3.16.0

Выполнить из каталога с проектом:

```
mkdir "../ReeePlayer_build"
cd "../ReeePlayer_build"
cmake --build . --config Release
```

## Прочее

- Иконки с сайта [Icons8.com](http://Icons8.com)
- Кадры, показанные в этом руководстве, из видео с канала [OverSimplified](https://www.youtube.com/c/OverSimplified/videos)
